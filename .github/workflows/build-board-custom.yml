name: Build board (custom)

on:
  workflow_dispatch:
    inputs:
      keyboard:
        description: 'Keyboard: Found in kbd_firmware/keyboards/[keyboard_name]'
        required: false
        default: crkbd
        type: string
      revision:
        description: 'Revision: '
        required: false
        default: rev4_1/standard
        type: string
      keymaps:
        description: 'Keymaps: via or vial'
        required: false
        default: vial
        type: string

run-name: ${{ inputs.keyboard }}-${{ inputs.revision }}-${{ inputs.keymaps }}

jobs:
  build:
    runs-on: ubuntu-24.04
    defaults:
      run:
        working-directory: ${{ github.workspace }}  # 设置全局工作目录为仓库根目录

    steps:

    # 设置文件名变量
    - name: Set build file name
      run: |
        FILE_NAME="${{ inputs.keyboard }}_${{ inputs.revision }}_${{ inputs.keymaps }}"
        SAFE_FILE_NAME=$(echo "$FILE_NAME" | sed 's/\//_/g')
        echo "FILE=$SAFE_FILE_NAME" >> $GITHUB_ENV
        echo "Using file name: $SAFE_FILE_NAME"

    - name: Upload artifact (vial)
      if: inputs.keymaps == 'vial'
      uses: actions/upload-artifact@v4
      with:
        name: ${{ env.FILE }}.uf2
        path: keyboards/${{ inputs.keyboard }}/vial-kb/vial-qmk/.build/${{ env.FILE }}.uf2
