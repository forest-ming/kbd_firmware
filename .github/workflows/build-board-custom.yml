name: Build board (custom)

on:
  workflow_dispatch:
    inputs:
      keyboard:
        description: 'Keyboard: Found in kbd_firmware/keyboards/[keyboard_name]'
        required: false
        default: crkbd
        type: string
      revision:
        description: 'Revision: '
        required: false
        default: rev4_1/standard
        type: string
      keymaps:
        description: 'Keymaps: via or vial'
        required: false
        default: vial
        type: string

run-name: ${{ inputs.keyboard }}-${{ inputs.revision }}-${{ inputs.keymaps }}

jobs:
  build:
    runs-on: ubuntu-24.04
    defaults:
      run:
        working-directory: ${{ github.workspace }}  # 设置全局工作目录为仓库根目录

    steps:


    - name: Upload artifact (vial)
      if: inputs.keymaps == 'vial'
      env:
        FILE: $(echo "${{ inputs.keyboard }}_${{ inputs.revision }}_${{ inputs.keymaps }}" | sed 's/\//_/g')
      uses: actions/upload-artifact@v4
      with:
        name: ${{ FILE }}.uf2
        path: keyboards/${{ inputs.keyboard }}/vial-kb/vial-qmk/.build/${{ FILE }}.uf2
